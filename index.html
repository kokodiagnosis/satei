<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>1åˆ†ã§å®Œçµï¼ç°¡å˜æŸ»å®š | æ ªå¼ä¼šç¤¾ãƒˆãƒªãƒ‹ãƒ†ã‚£</title>
  <style>
    :root {
      --main: #00469b;
      --sub: #ffcf00;
      --bg: #fffcf5;
      --msg-bot: #ffffff;
      --msg-user: #00469b;
    }

    body {
      font-family: "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100dvh;
      overflow: hidden;
    }

    #chat-container {
      flex: 1;
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      background: white;
      display: flex;
      flex-direction: column;
      position: relative;
      box-shadow: 0 4px 30px rgba(0,0,0,0.05);
      height: 100%;
    }

    .campaign-banner {
      background: linear-gradient(45deg, #d4af37, #f9f1c0, #d4af37);
      background-size: 200% auto;
      animation: shine 3s linear infinite;
      color: #542d05;
      padding: 8px;
      text-align: center;
      font-size: 13px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      z-index: 11;
      border-bottom: 1px solid #c5a028;
    }
    @keyframes shine { to { background-position: 200% center; } }

    .header {
      background: linear-gradient(135deg, #00469b, #0056b3);
      color: white;
      padding: 12px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      z-index: 10;
      flex-shrink: 0;
    }
    .header h1 { font-size: 16px; margin: 0; letter-spacing: 0.5px; }
    .header p { margin: 4px 0 0; font-size: 10px; opacity: 0.9; }

    #chat-log {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 20px 15px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: var(--bg);
      padding-bottom: 40px;
    }

    .chat-row { display: flex; align-items: flex-start; gap: 10px; animation: fadeIn 0.4s ease-out; }
    .chat-row.user { justify-content: flex-end; }

    .bot-container { display: flex; flex-direction: column; align-items: center; width: 55px; flex-shrink: 0; }
    .bot-icon { width: 45px; height: 45px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); object-fit: cover; background: #eee; }
    .bot-name { font-size: 9px; color: #555; margin-top: 4px; text-align: center; line-height: 1.2; font-weight: bold; }

    .msg {
      max-width: 78%;
      padding: 12px 16px;
      font-size: 15px;
      line-height: 1.6;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      word-wrap: break-word;
    }
    .bot { background: var(--msg-bot); border-radius: 4px 20px 20px 20px; color: #444; border: 1px solid #f0eddf; margin-top: 10px; }
    .user { background: var(--msg-user); color: white; border-radius: 20px 20px 4px 20px; }

    .alert-text { color: #d93025; font-weight: bold; border-bottom: 1px solid #d93025; }
    .msg strong { color: #000; font-weight: bold; }
    .msg a { color: #00469b; text-decoration: underline; }

    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 8px;
      margin-top: 10px;
      border: 1px solid #ddd;
    }
    .video-container iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }

    #input-area {
      padding: 15px;
      border-top: 1px solid #f0eddf;
      background: #fff;
      border-radius: 20px 20px 0 0;
      z-index: 20;
      flex-shrink: 0;
    }
    .options { display: flex; flex-direction: column; gap: 8px; }
    .opt-btn {
      background: #fff;
      border: 2px solid var(--main);
      color: var(--main);
      padding: 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
      font-size: 14px;
      transition: 0.3s;
    }
    .opt-btn:hover { background: #f0f7ff; transform: translateY(-1px); }

    input, textarea {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      box-sizing: border-box;
      font-size: 16px;
      margin-bottom: 10px;
      font-family: inherit;
    }
    input:focus, textarea:focus { border-color: var(--main); outline: none; background: #fdfdff; }

    .btn-group { display: flex; gap: 10px; }
    .next-btn {
      flex: 2;
      background: var(--sub);
      border: none;
      padding: 14px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
      color: #333;
      box-shadow: 0 4px 0 #e6ba00;
    }
    .next-btn:active { transform: translateY(2px); box-shadow: none; }
    .back-btn {
      flex: 1;
      background: #f5f5f5;
      border: none;
      padding: 14px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 13px;
      cursor: pointer;
      color: #777;
    }

    .hp-link-btn {
      display: block;
      background: #fff;
      border: 2px solid var(--main);
      color: var(--main);
      padding: 12px;
      border-radius: 12px;
      text-decoration: none;
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .footer-company {
      text-align: center;
      padding: 10px;
      font-size: 10px;
      background: white;
      color: #999;
      border-top: 1px solid #eee;
      flex-shrink: 0;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .typing { display: flex; gap: 5px; padding: 10px; }
    .typing span { width: 8px; height: 8px; background: #d0d0d0; border-radius: 50%; animation: blink 1.2s infinite; }
    @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
  </style>
</head>

<body>
  <div id="chat-container">
    <div class="campaign-banner">ğŸ æŸ»å®šé¢è«‡å®Œäº†ã§Amazonã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰1ä¸‡å††åˆ†é€²å‘ˆä¸­âœ¨</div>

    <div class="header">
      <h1>ğŸ  1åˆ†ã§å®Œçµï¼ç°¡å˜æŸ»å®š</h1>
      <p>by æ ªå¼ä¼šç¤¾ãƒˆãƒªãƒ‹ãƒ†ã‚£</p>
    </div>

    <div id="chat-log"></div>
    <div id="input-area"><div id="controls"></div></div>

    <div class="footer-company">
      <a href="https://trinity-111.com" target="_blank" style="color:#666; font-weight:bold;">
        æ ªå¼ä¼šç¤¾ãƒˆãƒªãƒ‹ãƒ†ã‚£ å…¬å¼ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
      </a>
    </div>
  </div>

  <script>
    const log = document.getElementById('chat-log');
    const controls = document.getElementById('controls');
    let userData = {};
    let currentStep = 0;

    // ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒï¼ˆåŒéšå±¤ã« icon.png ã‚’ç½®ã„ã¦ã­ï¼‰
    const iconImage = "./icon.png";

    const allSteps = [
      {
        id: 'intent',
        msg: 'ã“ã‚“ã«ã¡ã¯ï¼æŸ»å®šæ‹…å½“ã®è’æœ¨ã§ã™ã€‚<br><br>ã”å…¥åŠ›ã„ãŸã ãå€‹äººæƒ…å ±ã¯<strong>ã€ç§˜å¯†å³å®ˆã€‘</strong>ã§ç®¡ç†ã—ã€å¼·å¼•ãªå–¶æ¥­é›»è©±ãªã©ã¯ä¸€åˆ‡ã„ãŸã—ã¾ã›ã‚“ã€‚å®‰å¿ƒã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚<br><span style="font-size:12px">ğŸ”— <a href="https://trinity-111.com" target="_blank">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></span><br><br>ã¾ãšã¯ã€ç¾åœ¨ã®ã”æ¤œè¨çŠ¶æ³ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ',
        type: 'options',
        options: ['ã™ãã«å£²ã‚ŠãŸã„', 'åŠå¹´ä»¥å†…ã«æ¤œè¨ã—ãŸã„', 'ã¾ãšã¯ç›¸å ´ã‚’çŸ¥ã‚ŠãŸã„', 'åˆ¥ä½æ‰€ã®ç©ºãå®¶ã‚’ç›¸è«‡ã—ãŸã„']
      },
      {
        id: 'akiya_warning',
        msg: 'ç©ºãå®¶ã®ã”ç›¸è«‡ã§ã™ã­ã€‚å®Ÿã¯ä»Šã€æ”¾ç½®ãƒªã‚¹ã‚¯ãŒéå¸¸ã«é«˜ã¾ã£ã¦ã„ã¾ã™ã€‚<br><br>ğŸš¨ <span class="alert-text">ç›¸ç¶šç™»è¨˜ã®ç¾©å‹™åŒ–</span>ã«ã‚ˆã‚Šã€æ”¾ç½®ã™ã‚‹ã¨éæ–™ï¼ˆç½°å‰‡ï¼‰ã®å¯¾è±¡ã«ã€‚<br>ğŸš¨ ç‰¹å®šç©ºãå®¶æŒ‡å®šã§<span class="alert-text">å›ºå®šè³‡ç”£ç¨ãŒæœ€å¤§6å€</span>ã«è·³ã­ä¸ŠãŒã‚Šã¾ã™ã€‚<br><br>ä¸æ³•æŠ•æ£„ã‚„å®³è™«ã®ç™ºç”Ÿã§è¿‘éš£ãƒˆãƒ©ãƒ–ãƒ«ã«ãªã‚‹å‰ã«ã€ä¸€åº¦å‡ºå£æˆ¦ç•¥ã‚’ç«‹ã¦ã¾ã›ã‚“ã‹ï¼Ÿï¼ˆå…¨å›½å¯¾å¿œå¯èƒ½ã§ã™ï¼ï¼‰',
        type: 'options',
        options: ['ãƒªã‚¹ã‚¯ã‚’ç¢ºèªã—ã¦æŸ»å®šã«é€²ã‚€'],
        condition: () => userData.intent === 'åˆ¥ä½æ‰€ã®ç©ºãå®¶ã‚’ç›¸è«‡ã—ãŸã„'
      },
      {
        id: 'fast_warning',
        msg: 'ã€Œã™ãã«ã€ã¨ã„ã†ã”åˆ¤æ–­ã€ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼<br><br>æ˜¨ä»Šã®<span class="alert-text">é‡‘åˆ©ä¸Šæ˜‡</span>ã«ã‚ˆã‚Šã€ä¸å‹•ç”£ç›¸å ´ã®å…ˆè¡Œãã¯ä¸é€æ˜ã«ãªã‚Šã¤ã¤ã‚ã‚Šã¾ã™ã€‚ã ã‹ã‚‰ã“ãã€<strong>ã€Œä»Šã€ãŒæœ€ã‚‚é«˜ãå£²ã‚Œã‚‹ãƒãƒ£ãƒ³ã‚¹</strong>ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚<br><br>æœ€é©ãªãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã®ã§ã€ã¾ãšã¯ä¾¡æ ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼',
        type: 'options',
        options: ['æŸ»å®šã«é€²ã‚€'],
        condition: () => userData.intent === 'ã™ãã«å£²ã‚ŠãŸã„'
      },
      {
        id: 'mid_warning',
        msg: 'åŠå¹´ä»¥å†…ã®ã”æ¤œè¨ã§ã™ã­ã€‚éå¸¸ã«è³¢æ˜ã§ã™ã€‚<br><br>ã—ã‹ã—ã€<span class="alert-text">é‡‘åˆ©ã®ä¸Šæ˜‡å±€é¢</span>ã«å…¥ã‚Šã€åŠå¹´å¾Œã®ç›¸å ´ã¯èª­ã¿ã¥ã‚‰ããªã£ã¦ã„ã¾ã™ã€‚æ—©ã‚ã«ç¾åœ¨ã®ä¾¡å€¤ã‚’çŸ¥ã£ã¦ãŠãã“ã¨ã§ã€ä½™è£•ã‚’æŒã£ã¦ãƒ—ãƒ©ãƒ³ã‚’ç«‹ã¦ã‚‰ã‚Œã¾ã™ã€‚ã¾ãšã¯ç¾çŠ¶ã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†ã€‚',
        type: 'options',
        options: ['æŸ»å®šã«é€²ã‚€'],
        condition: () => userData.intent === 'åŠå¹´ä»¥å†…ã«æ¤œè¨ã—ãŸã„'
      },
      {
        id: 'market_warning',
        msg: 'ç›¸å ´ã®æŠŠæ¡ã€ã¨ã¦ã‚‚å¤§åˆ‡ã§ã™ï¼<br><br>å°†æ¥çš„ã«ç©ºãå®¶ã«ãªã‚Œã°<span class="alert-text">å›ºå®šè³‡ç”£ç¨ã®è² æ‹…å¢—</span>ãªã©ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚<strong>ã€Œä»Šã®ä¾¡å€¤ã€ã‚’çŸ¥ã£ã¦ãŠãã“ã¨ãŒæœ€å¤§ã®é˜²å¾¡ç­–</strong>ã§ã™ã€‚ãƒªã‚¹ã‚¯å›é¿ã®ãŸã‚ã«ã‚‚ç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼',
        type: 'options',
        options: ['ç„¡æ–™ã§ç›¸å ´ã‚’ç¢ºèªã™ã‚‹'],
        condition: () => userData.intent === 'ã¾ãšã¯ç›¸å ´ã‚’çŸ¥ã‚ŠãŸã„'
      },
      {
        id: 'type',
        msg: 'æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸï¼ç‰©ä»¶ã®ç¨®åˆ¥ã¯ã©ã¡ã‚‰ã§ã—ã‚‡ã†ã‹ï¼Ÿ',
        type: 'options',
        options: ['ãƒãƒ³ã‚·ãƒ§ãƒ³', 'ä¸€æˆ¸å»ºã¦', 'åœŸåœ°', 'ãã®ä»–']
      },
      {
        id: 'zip',
        msg: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚éƒµä¾¿ç•ªå·ã‚’7æ¡ã§å…¥åŠ›ã—ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿä½æ‰€ã‚’è‡ªå‹•ã§ãŠå‘¼ã³ã—ã¾ã™ã€‚',
        type: 'number',
        placeholder: 'ä¾‹: 1234567',
        condition: () => userData.intent !== 'åˆ¥ä½æ‰€ã®ç©ºãå®¶ã‚’ç›¸è«‡ã—ãŸã„'
      },
      {
        id: 'address',
        msg: () => userData.intent === 'åˆ¥ä½æ‰€ã®ç©ºãå®¶ã‚’ç›¸è«‡ã—ãŸã„'
          ? 'ç©ºãå®¶ã®ä½æ‰€ï¼ˆéƒ½é“åºœçœŒãƒ»å¸‚åŒºç”ºæ‘ã‹ã‚‰ï¼‰ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚'
          : 'ä½æ‰€ã‚„å»ºç‰©åã«é–“é•ã„ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿä¿®æ­£ã‚‚å¯èƒ½ã§ã™ã€‚<br><br><strong>â€»ãƒãƒ³ã‚·ãƒ§ãƒ³ã®å ´åˆã¯ã€å·å®¤ã¾ã§ã”è¨˜å…¥ãã ã•ã„ã€‚</strong>',
        type: 'text',
        placeholder: 'ä¾‹: æ±äº¬éƒ½æ¸¯åŒºã€‡ã€‡ ã€‡ã€‡ãƒãƒ³ã‚·ãƒ§ãƒ³ 402å·å®¤'
      },
      { id: 'unit_type', msg: 'é¢ç©ã®å˜ä½ã¯ã©ã¡ã‚‰ãŒã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã‹ï¼Ÿ', type: 'options', options: ['ã¡ï¼ˆå¹³ç±³ï¼‰', 'åªï¼ˆã¤ã¼ï¼‰'] },
      { id: 'area_val', msg: 'ãŠãŠã‚ˆãã®é¢ç©ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', type: 'number', placeholder: 'æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', suffix: () => userData.unit_type || '' },
      { id: 'house_building_msg', msg: 'å»ºç‰©ï¼ˆæˆ¸å»ºã¦ï¼‰ã®é¢ç©ã‚‚æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', type: 'number', placeholder: 'æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', condition: () => userData.type === 'ä¸€æˆ¸å»ºã¦', suffix: () => userData.unit_type || '' },
      { id: 'other_detail', msg: 'ã”ç›¸è«‡å†…å®¹ï¼ˆä¾‹ï¼šåº—èˆ—ã€å…±æœ‰åç¾©ã€ç©ºãå®¶ã®çŠ¶æ…‹ãªã©ï¼‰ã‚’è©³ã—ãæ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', type: 'textarea', placeholder: 'ã“ã¡ã‚‰ã«ã”è¨˜å…¥ãã ã•ã„', condition: () => userData.type === 'ãã®ä»–' || userData.intent === 'åˆ¥ä½æ‰€ã®ç©ºãå®¶ã‚’ç›¸è«‡ã—ãŸã„' },
      { id: 'calculating', msg: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ãŸã ã„ã¾æœ€æ–°ã®ç›¸å ´äº‹ä¾‹ã¨ãƒªã‚¹ã‚¯å›é¿ç­–ã‚’ä¸€ç”Ÿæ‡¸å‘½ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™...', type: 'loading', duration: 2000 },
      { id: 'name', msg: 'ãŠå¾…ãŸã›ã—ã¾ã—ãŸï¼ç®—å‡ºã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚æœ€å¾Œã«ãŠåå‰ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚', type: 'text', placeholder: 'ä¾‹: ç”°ä¸­ å¤ªéƒ' },
      { id: 'tel', msg: 'ã”é€£çµ¡å…ˆã®é›»è©±ç•ªå·ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚å¼·å¼•ãªå–¶æ¥­ã¯è¡Œã„ã¾ã›ã‚“ã®ã§ã”å®‰å¿ƒãã ã•ã„ã€‚', type: 'tel', placeholder: 'ä¾‹: 09012345678' },
      { id: 'email', msg: 'æœ€å¾Œã§ã™ï¼æŸ»å®šçµæœã‚’ãŠé€ã‚Šã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', type: 'email', placeholder: 'ä¾‹: mail@example.com' },
      {
        id: 'finish',
        msg: 'ã™ã¹ã¦å®Œäº†ã—ã¾ã—ãŸï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ç‰¹å…¸ã®Amazonã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰1ä¸‡å††åˆ†ã‚‚é¢è«‡å®Œäº†æ™‚ã«é€²å‘ˆã„ãŸã—ã¾ã™ã€‚<br><br>â–¼ ãƒˆãƒªãƒ‹ãƒ†ã‚£ã®æƒ³ã„ï¼ˆå‹•ç”» 3ç§’ã€œï¼‰<br><div class="video-container"><iframe width="560" height="315" src="https://www.youtube.com/embed/IFcxSeXWO1w?start=3" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div>',
        type: 'final'
      }
    ];

    function getActiveSteps() {
      return allSteps.filter(s => !s.condition || s.condition());
    }

    function addMessage(text, side) {
      const row = document.createElement('div');
      row.className = `chat-row ${side}`;

      if (side === 'bot') {
        const container = document.createElement('div');
        container.className = 'bot-container';
        container.innerHTML = `
          <img src="${iconImage}" class="bot-icon" alt="æ‹…å½“è€…" onerror="this.style.display='none'">
          <div class="bot-name">æŸ»å®šæ‹…å½“<br>è’æœ¨</div>
        `;
        row.appendChild(container);
      }

      const msgDiv = document.createElement('div');
      msgDiv.className = `msg ${side}`;
      msgDiv.innerHTML = text;
      row.appendChild(msgDiv);

      log.appendChild(row);
      scrollToBottom();
    }

    function scrollToBottom() { log.scrollTop = log.scrollHeight; }

    async function handleInput(val) {
      const activeSteps = getActiveSteps();
      const step = activeSteps[currentStep];

      const value = val ?? document.getElementById('input-field')?.value ?? "";
      if (!value && step.type !== 'loading') return;

      userData[step.id] = value;

      // user message
      const row = document.createElement('div');
      row.className = `chat-row user`;
      const msgDiv = document.createElement('div');
      msgDiv.className = `msg user`;
      msgDiv.innerText = value + (step.suffix ? step.suffix() : "");
      row.appendChild(msgDiv);
      log.appendChild(row);
      scrollToBottom();

      // zip auto address
      if (step.id === 'zip') {
        try {
          const res = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${value}`);
          const data = await res.json();
          if (data.results) {
            const r = data.results[0];
            userData['address_auto'] = r.address1 + r.address2 + r.address3;
          }
        } catch (e) {}
      }

      currentStep++;
      showStep();
    }

    function goBack() {
      if (currentStep <= 0) return;

      currentStep--;
      const activeSteps = getActiveSteps();
      log.innerHTML = "";

      for (let i = 0; i < currentStep; i++) {
        const msgText = typeof activeSteps[i].msg === 'function' ? activeSteps[i].msg() : activeSteps[i].msg;
        addMessage(msgText, 'bot');

        const row = document.createElement('div');
        row.className = `chat-row user`;
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg user`;
        msgDiv.innerText = (userData[activeSteps[i].id] ?? "") + (activeSteps[i].suffix ? activeSteps[i].suffix() : "");
        row.appendChild(msgDiv);
        log.appendChild(row);
      }

      scrollToBottom();
      showStep();
    }

    function showStep() {
      const activeSteps = getActiveSteps();
      if (currentStep >= activeSteps.length) return;

      const step = activeSteps[currentStep];
      const msgText = typeof step.msg === 'function' ? step.msg() : step.msg;

      addMessage(msgText, 'bot');
      scrollToBottom();

      if (step.type === 'loading') {
        controls.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';
        setTimeout(() => { currentStep++; showStep(); }, step.duration);
        return;
      }

      if (step.type === 'options') {
        let html = '<div class="options">';
        step.options.forEach(opt => html += `<button class="opt-btn" onclick="handleInput('${opt}')">${opt}</button>`);
        if (currentStep > 0) html += `<button class="back-btn" onclick="goBack()" style="margin-top:5px;">â† å‰ã¸æˆ»ã‚‹</button>`;
        html += '</div>';
        controls.innerHTML = html;
        return;
      }

      if (step.type === 'final') {
        controls.innerHTML = `
          <a href="https://trinity-111.com" target="_blank" class="hp-link-btn">æ ªå¼ä¼šç¤¾ãƒˆãƒªãƒ‹ãƒ†ã‚£ å…¬å¼ã‚µã‚¤ãƒˆ</a>
          <button class="next-btn" onclick="location.reload()">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
        `;

        // â˜…é€ä¿¡ï¼ˆå®‰å®šã®HTMLãƒ•ã‚©ãƒ¼ãƒ POSTæ–¹å¼ï¼‰â€” å°‘ã—é…ã‚‰ã›ã¦ç¢ºå®Ÿã«
        setTimeout(sendDataToGoogle, 300);
        return;
      }

      const val = (step.id === 'address' && userData['address_auto']) ? userData['address_auto'] : "";
      const inputHtml = step.type === 'textarea'
        ? `<textarea id="input-field" rows="3" placeholder="${step.placeholder}">${val}</textarea>`
        : `<div style="position:relative;">
             <input type="${step.type}" id="input-field" placeholder="${step.placeholder}" value="${val}">
             ${step.suffix ? `<span style="position:absolute; right:15px; top:14px; color:#888;">${step.suffix()}</span>` : ''}
           </div>`;

      controls.innerHTML = `
        ${inputHtml}
        <div class="btn-group">
          <button class="back-btn" onclick="goBack()">æˆ»ã‚‹</button>
          <button class="next-btn" onclick="handleInput()">æ¬¡ã¸é€²ã‚€</button>
        </div>
      `;

      setTimeout(() => {
        const input = document.getElementById('input-field');
        if (input) input.focus();
        scrollToBottom();
      }, 100);
    }

    // =========================
    // Googleãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼ˆå®‰å®šç‰ˆï¼‰
    // =========================
    function sendDataToGoogle() {
      // â˜…è¤‡è£½å¾Œãƒ•ã‚©ãƒ¼ãƒ IDï¼ˆã‚ãªãŸãŒè²¼ã£ã¦ãã‚ŒãŸã‚‚ã®ï¼‰
      const formId = "1FAIpQLScD7gFXpxlOte8FQHWAlm4Xv0MJH7MoqAuIwAimXlwZvNLNsA";
      const formUrl = `https://docs.google.com/forms/d/e/${formId}/formResponse`;

      // hidden iframeï¼ˆç”»é¢é·ç§»ã—ãªã„ï¼‰
      let iframe = document.getElementById("hidden_iframe");
      if (!iframe) {
        iframe = document.createElement("iframe");
        iframe.name = "hidden_iframe";
        iframe.id = "hidden_iframe";
        iframe.style.display = "none";
        document.body.appendChild(iframe);
      }

      const form = document.createElement("form");
      form.action = formUrl;
      form.method = "POST";
      form.target = "hidden_iframe";

      const add = (name, value) => {
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = name;
        input.value = value ?? "";
        form.appendChild(input);
      };

      // 1. æ¤œè¨çŠ¶æ³ï¼ˆç©ºãå®¶è©³ç´°ã‚’çµåˆï¼‰
      let intentVal = userData.intent || "";
      if (userData.other_detail) {
        intentVal += " (è©³ç´°: " + userData.other_detail + ")";
      }

      // entryç•ªå·ï¼ˆã‚ãªãŸã®äº‹å‰å…¥åŠ›ãƒªãƒ³ã‚¯ã¨ä¸€è‡´ï¼‰
      add("entry.39702896", intentVal);                 // æ¤œè¨çŠ¶æ³
      add("entry.1956018558", userData.type || "");     // ç‰©ä»¶ç¨®åˆ¥
      add("entry.1184450983", userData.zip || "");      // éƒµä¾¿ç•ªå·
      add("entry.436082943", userData.address || "");   // ä½æ‰€

      // é¢ç©ï¼ˆå˜ä½çµåˆï¼‰
      let areaStr = userData.area_val || "";
      if (userData.unit_type) areaStr += userData.unit_type;
      add("entry.159085778", areaStr);                 // é¢ç©

      add("entry.1607874063", userData.name || "");    // åå‰
      add("entry.996995416", userData.tel || "");      // é›»è©±ç•ªå·
      add("entry.427371744", userData.email || "");    // ãƒ¡ãƒ¼ãƒ«
      add("pageHistory", "0");
      document.body.appendChild(form);
      form.submit();
      form.remove();
    }

    // èµ·å‹•
    showStep();
  </script>
</body>
</html>

